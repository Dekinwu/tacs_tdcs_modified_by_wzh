/*--------------------------------------------------------------------------
File Name:12864R5.C;
Description:This Resouce Is For Dot Matrix Liquid Crystal 
            Modules Controlled By Sitronix'S ST7565R

Author By:XIAHANG
Date:20080605
--------------------------------------------------------------------------*/


#include <reg51.h>
#include <INTRINS.H>


#define  uchar unsigned char
#define  uint unsigned int
#define  uchar_code unsigned char code

#define DELAYMS 	100
#define DataPort 	



uchar_code border_inf[8] = {
	0x00,0x00,0x00,0x80,0x01,0x00,0x00,0x00 };


uchar_code corp_pic[] = {
/*--  调入了一幅图像：E:\2008设计项目\Test Programs\lcm_取模图片\12864（福瑞博）.bmp  --*/
/*--  宽度x高度=128x64  --*/
0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,
0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x80,0x00,0xF8,0x00,
0x00,0xF8,0x50,0x50,0x50,0xF0,0x50,0x50,0xF8,0x00,0x00,0x20,0x20,0xC0,0x40,0x40,
0xF8,0x00,0xF0,0x00,0xF0,0x08,0xF8,0x00,0x00,0x00,0x00,0xF8,0x00,0x00,0x80,0x80,
0xE0,0xB0,0xC8,0x88,0xF8,0x80,0x80,0x80,0x00,0x00,0x80,0x00,0x00,0xF8,0x80,0x80,
0x80,0x80,0x88,0xF8,0x00,0x00,0x00,0x00,0x00,0xF8,0x40,0x60,0xC0,0x00,0xF8,0x10,
0x20,0xC0,0xE0,0xB0,0x18,0x10,0x80,0x00,0x00,0x18,0x28,0xD8,0x10,0x10,0x90,0x50,
0x38,0x18,0x00,0x00,0x00,0x00,0x00,0x00,0xE0,0x40,0x40,0x40,0x40,0xE0,0x00,0x08,
0x0C,0xF8,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,
0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x10,0x11,0xD3,0x1E,
0x11,0x61,0x5F,0x55,0x55,0x55,0x55,0xFF,0x43,0x00,0x00,0x44,0x44,0x7F,0x44,0x44,
0xF7,0x15,0x17,0xF5,0x15,0x15,0xFF,0x05,0x00,0x08,0x08,0xFF,0x08,0x08,0x20,0x3F,
0x35,0x35,0xFF,0x35,0xF5,0x3F,0x61,0x20,0x00,0x20,0x20,0x21,0x26,0x2F,0x7A,0xEA,
0xAA,0x2A,0x2A,0x3F,0x60,0x60,0x00,0x00,0x00,0xFF,0x44,0x5A,0xE1,0x00,0xFF,0x94,
0x97,0x94,0x94,0xFD,0x01,0x00,0x00,0x01,0x02,0x0C,0x38,0x60,0x07,0x02,0x00,0xF0,
0x0C,0x06,0x03,0x02,0x00,0x00,0x08,0x08,0x4F,0x4A,0x4A,0x4A,0x4A,0x4F,0x5A,0x48,
0x40,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,
0xFF,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x81,0x80,0x80,
0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,
0x80,0x80,0x80,0x81,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,
0x80,0x80,0x80,0x81,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,
0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,
0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,
0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,
0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0xFF,
0xFF,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,
0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,
0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,
0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,
0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,
0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,
0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,
0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0xFF,
0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xF0,
0x00,0x00,0xF0,0xA0,0xA0,0xA0,0xE0,0xA0,0xA0,0xF0,0x00,0x00,0x40,0x40,0x80,0x80,
0x80,0xF0,0x00,0xE0,0x00,0xE0,0x10,0xF0,0x00,0x00,0x00,0x00,0xF0,0x00,0x00,0x00,
0x00,0xC0,0x60,0x90,0x10,0xF0,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xF0,0x00,
0x00,0x00,0x00,0x10,0xF0,0x00,0x00,0x00,0x00,0x00,0xF0,0x80,0xC0,0x80,0x00,0xF0,
0x20,0x40,0x80,0xC0,0x60,0x30,0x20,0x00,0x00,0x00,0x30,0x50,0xB0,0x20,0x20,0x20,
0xA0,0x70,0x30,0x00,0x00,0x00,0x00,0x00,0x00,0xC0,0x80,0x80,0x80,0x80,0xC0,0x00,
0x10,0x18,0xF0,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,
0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x21,0x22,0xA7,
0x3C,0x22,0xC3,0xBE,0xAA,0xAA,0xAB,0xAA,0xFE,0x87,0x00,0x00,0x88,0x88,0xFF,0x88,
0x88,0xEF,0x2A,0x2F,0xEA,0x2B,0x2A,0xFF,0x0A,0x00,0x10,0x10,0xFF,0x10,0x10,0x41,
0x7F,0x6B,0x6B,0xFF,0x6B,0xEB,0x7F,0xC3,0x41,0x00,0x40,0x41,0x42,0x4C,0x5F,0xF5,
0xD5,0x55,0x55,0x55,0x7F,0xC0,0xC0,0x00,0x00,0x00,0xFF,0x88,0xB4,0xC3,0x00,0xFF,
0x28,0x2E,0x29,0x29,0xFB,0x02,0x00,0x01,0x02,0x04,0x18,0x70,0xC1,0x0E,0x04,0x01,
0xE0,0x18,0x0C,0x06,0x04,0x00,0x00,0x10,0x10,0x9F,0x94,0x94,0x94,0x94,0x9F,0xB4,
0x90,0x80,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,
0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x02,0x01,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x01,0x00,0x00,0x03,0x00,0x00,0x01,0x00,0x00,0x00,0x00,0x01,0x00,0x00,0x00,
0x00,0x00,0x00,0x01,0x02,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x01,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x00,0x00,0x01,0x00,0x01,
0x01,0x01,0x01,0x01,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,

};


#pragma disable
void delay(uint dlyms)
{
	uint ui_dlay1;
	for (ui_dlay1=0; ui_dlay1<dlyms; ui_dlay1++);
}


#pragma disable
void delayms()
{
	uint ui_dlay1,ui_dlay2;
	ui_dlay2 = DELAYMS;
	while (ui_dlay2-- >0)
		for (ui_dlay1=0; ui_dlay1<500; ui_dlay1++){};
}


#pragma disable
void Func_int0() interrupt 0 using 1
{
	if (ui_pause == 0)
 		ui_pause = 1;
	else
		ui_pause = 0;


	if ( ui_pause == 1 )
		while (1)
		{
			if (PAUSE == 0)
				return;
		}
}


	 /*
#pragma disable
void wr_dat(uchar uc_dat)
{
	
	DataPort = uc_dat;
	P_CS1 = 0;
	P_E   = 0;
	P_RS  = 1;
	P_RW  = 0;
	P_E   = 1;
	_nop_();
	_nop_();
	P_E = 0;
	P_CS1 = 1;
  delay(10);
}


#pragma disable
void wr_cmd(uchar cmd)
{
	
	DataPort = cmd;
	P_CS1 = 0;
	P_E   = 0;
	P_RS  = 0;
	P_RW  = 0;
	P_E   = 1;
	_nop_();
	_nop_();
	P_E = 0;
	P_CS1 = 1;
  delay(10);	
 
}

	*/

//----------------------------spi ----------------//
void wr_cmd(uchar cmd)
{
 uchar k;

P_CS1 = 0;
P_RS = 0;

 for (k=0; k<8; k++)
 {
 cmd = cmd<<1;
 SCL = 0;
 SDA = CY;
 SCL = 1;
 }

P_CS1=1;
}
//----------------------------writedata------------------//
void wr_dat(uchar dat)
{
 uchar k;

P_CS1 = 0;
P_RS = 1;

 for (k=0; k<8; k++)
 {
 dat = dat<<1;
 SDA = CY;
 SCL = 0;
 SCL = 1;
 }

P_CS1=1;
}

#pragma disable
void Initial()
{

	wr_cmd(0xA0);//set seg direct	  A0=seg0→131    /	 A1=seg131→0
	
	wr_cmd(0xC0);//set com direct	C0=COM0→COM63	 / 	 C1=COM63→COM0
	
	wr_cmd(0xA2);//set lcd bias
	
        wr_cmd(0x24);//set internal rb/ra

	wr_cmd(0x2F);//all power on

	wr_cmd(0x81);//set contrast
	wr_cmd(52);
	
	wr_cmd(0xAF);//dispaly on
	

}

#pragma disable
void disp_dat(uchar uc_dat1,uchar uc_dat2,uint Is_Twice)
{
	uint page_cnt,col_cnt;
	uchar pg_address;

	pg_address = 0xB0;

	for (page_cnt=0;page_cnt<8;page_cnt++)
	{
	
		wr_cmd(pg_address); 

	
		wr_cmd(0x10);


		wr_cmd(0x01);
		for (col_cnt=0;col_cnt<32;col_cnt++)
		{
			if (Is_Twice == 0)
			{
				wr_dat(uc_dat1);	//   delayms();
				wr_dat(uc_dat2);	//  delayms();
				wr_dat(uc_dat1);	//  delayms();
				wr_dat(uc_dat2);	//  delayms();//delayms();delayms();
			}
			else
			{
				wr_dat(uc_dat1);
				wr_dat(uc_dat1);
				wr_dat(uc_dat2);
				wr_dat(uc_dat2);
			}
		}
			 //delayms();delayms();
		pg_address ++;
	}
	delayms();
}

#pragma disable
void disp_border()
{
	uint page_cnt,col_cnt;
	uchar pg_address;

	pg_address = 0xB0;

	for (page_cnt=0;page_cnt<8;page_cnt++)
	{
	
		wr_cmd(pg_address); 


		wr_cmd(0x10);

	
		wr_cmd(0x01);

		wr_dat(0xFF);
		
		for (col_cnt=0;col_cnt<126;col_cnt++)
		{
			wr_dat(border_inf[page_cnt]);
		}

		wr_dat(0xFF);

		pg_address ++;
	
	}
	delayms();
}
			
#pragma disable
void disp_bmp(uchar_code *bmparea)
{
	uint page_cnt,col_cnt;
	uchar pg_address;

	pg_address = 0xB0;
	for (page_cnt=0;page_cnt<8;page_cnt++)
	{

		wr_cmd(pg_address); 


		wr_cmd(0x10);


		wr_cmd(0x01);

		for (col_cnt=0;col_cnt<128;col_cnt++)
		{
			wr_dat(bmparea[page_cnt*128 + col_cnt]);
		}

		pg_address ++;
	}
	
	delayms();
}
/*	
void disp_bmp(uchar_code *bmparea)
{
	uint page_cnt,col_cnt;
	uchar pg_address;

	pg_address = 0xB7;
	for (page_cnt=7;page_cnt>0;page_cnt--)
	{

		wr_cmd(pg_address); 


		wr_cmd(0x10);


		wr_cmd(0x01);

		for (col_cnt=0;col_cnt<128;col_cnt++)
		{
			wr_dat(bmparea[page_cnt*128 + col_cnt]);
		}

		pg_address --;
	}
	
	delayms();
}	*/
void main()
{

		
//	EA=1; 

//	IT0 = 1;

//	EX0 = 1;


	_nop_();
	_nop_();

	//P_CS2 = 1;
//	_nop_();
//	_nop_();

	P_RST=0;
	delay(250);
	delay(250);
	delay(250);
	delay(250);
	P_RST=1;
	delay(250);
	delay(250);

	Initial();
	   disp_dat(0x00,0x00,1);
	while(1)
	{

		   	disp_dat(0xFF,0xFF,0);
		  	disp_border();


		disp_bmp(corp_pic);
		
	
	//	disp_border();

	 
		disp_dat(0x55,0x55,0);
		

		disp_dat(0xAA,0xAA,1);


	//	disp_dat(0x33,0x33,1);


	//	disp_dat(0xFF,0x00,1);


//		disp_dat(0x00,0xFF,1);


	//	disp_dat(0xFF,0x00,1);


		disp_dat(0x55,0xAA,0);


		disp_dat(0xAA,0x55,0);

		
		
	
		
	};
 }













